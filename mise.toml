min_version = { soft = "2024.9.0", hard = "2024.11.1" }

[tools]
rust = "1.91.1"
age = "latest"
fnox = "latest"
uv = "latest"

[env]
CARGO_TERM_COLOR = "always"

[vars]
cargo_workspace = "--workspace"

[tasks.bootstrap]
description = "Install all toolchains declared in mise.toml"
run = "mise install"

[tasks.encrypt]
description = "Encrypt private docs -> impl-docs/_encrypted/"
run = "uv run scripts/crypto.py encrypt --dir all"

[tasks.decrypt]
description = "Decrypt impl-docs/_encrypted/ -> private/"
run = "uv run scripts/crypto.py decrypt --dir all"

[tasks.check]
description = "Fast type-check across the Rust workspace"
run = "cargo check {{vars.cargo_workspace}}"

[tasks.fmt]
description = "Ensure Rust source is formatted"
run = "cargo fmt -- --check"

[tasks.clippy]
description = "Run clippy with warnings elevated to errors"
run = "cargo clippy --all-targets --all-features -D warnings"

[tasks.test]
description = "Execute the full Rust test suite"
depends = ["check"]
run = "cargo test {{vars.cargo_workspace}}"

[tasks.validate]
description = "Aggregate validation task for CI"
depends = ["fmt", "clippy", "test"]
run = "echo finished validation checks"
